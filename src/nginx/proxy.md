koji构建体系的代理处理
=====================

- 背景

  由于要在同一台机器上搭建koji构建体系，而原koji构建体系各种服务不在同一台
机器上，这就需要处理一个问题，这些服务的冲突问题。原koji服务搭建在33.17上，
整个服务占用80端口，用的是apache服务器，而git仓库服务是搭建在33.20上，用
的是nginx服务器，具体怎么搭建的不得而知，pkgs缓存服务器也是搭建在33.20上，
搭建也不是太清楚，需要把这些服务整合到一台机器上

- 限制

  koji服务器用的apache，迁移到nginx上要付出很大的代价。所以koji尽量不动。

- 尝试

  git服务之前用的是gitlab，这个比较重量级，在一台机器上，我用gogs代替了，
pkgs服务用的是fileserver，go写的小型文件服务器，好吧，我在这儿遇到了坑，
有些文件在网页上不能下载，最后经过领导指点，可能跟端口及dns服务有关，最后
改了端口后表现正常。

  我准备把git和pkgs服务迁移到apache上，其实这是很蛋疼的事，我稍微搜了一下，
都是从apache迁移到nginx。迁移过程中，发现80端口要做为代理访问端口，就是
什么请求过来，到80后再转发。迁移后，git和pkgs服务表现正常，koji服务不正常，
原因80端口原来是默认访问koji的，koji的配置比较复杂，不好乱改。当然两个网页服务
器不能同时开启（之后的做法验证了这种想法是错误的）,都占用80端口。

  最后想了想，把apache的默认服务端口改到了8080，这样就好了，同时开启nginx监测
80端口进行代理转发，把对于koji.isoft.zhcn.cc的请求转发到http://127.0.0.1:8080，
把对于pkgs.isoft.zhcn.cc的请求转发到http://127.0.0.1:9000，把对于git.isoft.zhcn.cc
的请求转发到http://127.0.0.1:3000。改完之后发现一切正常。

  在以上做法中，其实就是把nginx当成了一个代理服务器，代理了其他三个服务器的服务

- 反思

  apache上肯定能实现这些配置，谁知道要动多少东西呢，也许很少，就改一点，也许。。。
有时间再去琢磨这些吧
